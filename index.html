<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CYBERGAME | Natsumi Elite</title>
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/681/681494.png">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

</head>

<body>
    <div id="toast-container"></div>

    <div id="auth-screen" class="overlay">
        <div class="auth-card glass">
            <h1 class="logo">CYBER<span>GAME</span></h1>
            <div id="auth-form">
                <div class="input-group">
                    <i class="fas fa-user"></i>
                    <input type="text" id="user-input" placeholder="T√™n ƒëƒÉng nh·∫≠p">
                </div>
                <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="pass-input" placeholder="M·∫≠t kh·∫©u">
                </div>
                <div class="auth-btns">
                    <button onclick="handleAuth('login')" class="btn-main">ƒêƒÇNG NH·∫¨P</button>
                    <button onclick="handleAuth('register')" class="btn-sub">ƒêƒÇNG K√ù</button>
                </div>
            </div>
            <p class="footer-hint">Thi·∫øt k·∫ø b·ªüi Natsumi Pro Edition 2026</p>
        </div>
    </div>
    <div id="loading-screen">Loading...</div>

    <div id="app-interface" class="app-wrapper hidden">
        <aside class="sidebar">
            <div class="side-icons">
                <div class="nav-btn active" onclick="goHome()" style="font-size:20px;">üè†</div>
                <div class="nav-btn" onclick="showSection('game-list')" style="font-size:20px;">üéÆ</div>
                <div id="admin-shield" class="nav-btn hidden" onclick="showSection('admin')" style="font-size:20px;">üõ°Ô∏è</div>
                <div class="nav-btn logout-btn" onclick="logout()" title="ƒêƒÉng xu·∫•t" style="font-size:20px;">üö™</div>
            </div>
            <div class="side-user">
                <div class="gold-box" title="Robux/Gold">
                    <span id="gold-val">1,000</span> <i class="fas fa-coins"></i>
                </div>
                <div class="avatar-wrapper" onclick="openProfile()">
                    <img id="side-avatar" src="" class="circle-avatar">
                    <div class="online-dot"></div>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <header class="top-bar">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="search-input" placeholder="T√¨m ki·∫øm game Natsumi...">
                </div>
                <div class="user-header" onclick="openProfile()">
                    <span id="user-display">Guest</span>
                    <i id="v-badge" class="fas fa-check-circle verified hidden"></i>
                </div>
            </header>

            <section id="sec-home" class="page">
                <div class="hero">
                    <h1>Xin ch√†o, <span id="greet-name">Player</span>!</h1>
                    <p>Ch√†o m·ª´ng b·∫°n quay tr·ªü l·∫°i h·ªá th·ªëng.</p>
                </div>
                <div class="grid">
                    <div class="card" onclick="showSection('noitu-setup')">
                        <div class="thumb purple" style="font-size:2.5rem;display:flex;align-items:center;justify-content:center;">üî§</div>
                        <div class="info"><b>N·ªëi T·ª´ Battle</b>
                            <p>Th·ª≠ t·ª´ c√° nh√¢n</p>
                        </div>
                    </div>
                    <div class="card" onclick="devMode()">
                        <div class="thumb ocean" style="font-size:2.5rem;display:flex;align-items:center;justify-content:center;">üé≤</div>
                        <div class="info"><b>C·ªù T·ª∑ Ph√∫ Tycoon</b>
                            <p>ƒêang ph√°t tri·ªÉn...</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="sec-noitu-setup" class="page hidden">
                <div class="setup-wrapper">
                    <div class="setup-header">
                        <span style="font-size:2.5rem;">üéÆ</span>
                        <h2>Thi·∫øt l·∫≠p tr·∫≠n ƒë·∫•u</h2>
                        <p>T·∫°o ph√≤ng m·ªõi ho·∫∑c tham gia ph√≤ng c√≥ s·∫µn</p>
                    </div>

                    <div class="setup-body">
                        <!-- C·ªòT TR√ÅI: T·∫°o ph√≤ng -->
                        <div class="setup-card glass">
                            <div class="setup-card-title">
                                ‚ûï
                                T·∫°o ph√≤ng m·ªõi
                            </div>

                            <div class="setup-field">
                                <label>Ch·∫ø ƒë·ªô ch∆°i</label>
                                <div class="mode-btns">
                                    <button class="mode-btn active" id="mode-test" onclick="selectMode('bot', this)">
                                        <i class="fas fa-flask"></i> Test t·ª´
                                    </button>
                                    <button class="mode-btn" id="mode-player" onclick="selectMode('player', this)">
                                        <i class="fas fa-users"></i> Nhi·ªÅu ng∆∞·ªùi
                                    </button>
                                </div>
                                <input type="hidden" id="game-mode" value="bot">
                            </div>

                            <div class="setup-field">
                                <label>S·ªë ng∆∞·ªùi ch∆°i t·ªëi ƒëa</label>
                                <div class="player-count-row">
                                    <button class="count-btn" onclick="changeCount(-1)">‚àí</button>
                                    <input type="number" id="player-count" value="2" min="2" max="200"
                                           oninput="let v=parseInt(this.value);if(v>200)this.value=200;if(v<2&&this.value.length>0)this.value=2;"
                                       style="width:70px;text-align:center;background:#18181b;border:1px solid rgba(255,255,255,0.1);
                                                  color:white;border-radius:10px;padding:8px;font-size:1.1rem;font-weight:bold;">
                                    <button class="count-btn" onclick="changeCount(1)">+</button>
                                    <span style="color:#a1a1aa;font-size:0.8rem;margin-left:8px;">t·ªëi ƒëa 200</span>
                                </div>
                            </div>

                            <button class="btn-create-new" onclick="createRoom()">
                                üöÄ T·∫†O PH√íNG M·ªöI
                            </button>
                        </div>

                        <!-- C·ªòT PH·∫¢I: V√†o ph√≤ng -->
                        <div class="setup-card glass">
                            <div class="setup-card-title">
                                üö™
                                V√†o ph√≤ng c√≥ s·∫µn
                            </div>

                            <div class="setup-field">
                                <label>Nh·∫≠p m√£ ph√≤ng (6 k√Ω t·ª±)</label>
                                <div class="otp-row" id="otp-container">
                                    <input type="text" maxlength="1" class="otp-input">
                                    <input type="text" maxlength="1" class="otp-input">
                                    <input type="text" maxlength="1" class="otp-input">
                                    <input type="text" maxlength="1" class="otp-input">
                                    <input type="text" maxlength="1" class="otp-input">
                                    <input type="text" maxlength="1" class="otp-input">
                                </div>
                            </div>

                            <button class="btn-join-new" onclick="joinRoom()">
                                üö™ V√ÄO PH√íNG
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <section id="sec-lobby" class="page hidden">
                <div class="lobby-ui glass">
                    <div class="lobby-header">
                        <h3>S·∫£nh Ch·ªù N·ªëi T·ª´</h3>
                        <div class="room-badge">M√£ ph√≤ng: <span id="display-room-code">------</span></div>
                    </div>
                    <div class="player-list" id="lobby-players"></div>
                    <div class="lobby-footer">
                        <button class="btn-main pulse" id="start-btn" onclick="triggerCountdown()"
                            style="display:none;">
                            B·∫ÆT ƒê·∫¶U NGAY
                        </button>

                        <button class="btn-sub" onclick="showSection('noitu-setup')">H·ª¶Y</button>
                    </div>
                </div>
            </section>

            <section id="sec-game-play" class="page hidden">
                <div style="display:flex;gap:15px;height:calc(100vh - 80px);padding:20px;">

                    <!-- Panel online b√™n ph·∫£i -->
                    <div style="width:200px;flex-shrink:0;order:2;display:flex;flex-direction:column;
                                background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);
                                border-radius:16px;overflow:hidden;">

                        <!-- Header + search c·ªë ƒë·ªãnh -->
                        <div style="padding:12px;border-bottom:1px solid rgba(255,255,255,0.07);flex-shrink:0;">
                            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
                                <div style="font-size:0.72rem;color:#a1a1aa;font-weight:bold;letter-spacing:1px;">
                                    üë• NG∆Ø·ªúI CH∆†I
                                </div>
                                <button onclick="leaveRoom()" title="Tho√°t ph√≤ng"
                                    style="background:rgba(239,68,68,0.15);border:1px solid rgba(239,68,68,0.4);
                                           color:#ef4444;border-radius:8px;padding:4px 8px;cursor:pointer;
                                           font-size:0.7rem;display:flex;align-items:center;gap:4px;transition:0.2s;"
                                    onmouseover="this.style.background='rgba(239,68,68,0.3)'"
                                    onmouseout="this.style.background='rgba(239,68,68,0.15)'">
                                    üö™ Tho√°t
                                </button>
                            </div>
                            <div style="display:flex;align-items:center;gap:6px;
                                        background:rgba(255,255,255,0.06);
                                        border:1px solid rgba(255,255,255,0.1);
                                        border-radius:8px;padding:5px 10px;">
                                üîç
                                <input type="text" id="panel-search"
                                       placeholder="T√¨m ng∆∞·ªùi ch∆°i..."
                                       oninput="filterPanel(this.value)"
                                       style="background:transparent;border:none;color:white;
                                              font-size:0.75rem;outline:none;width:100%;">
                            </div>
                        </div>

                        <!-- Danh s√°ch scroll ƒë∆∞·ª£c -->
                        <div id="online-panel" style="flex:1;overflow-y:auto;padding:10px;">
                        </div>
                    </div>

                <div class="game-container" style="flex:1;height:100%;padding:0;position:relative;">
                    <div class="game-header">
                        <div class="turn-indicator" id="turn-info">ƒêang ch·ªù...</div>
                        <div class="last-word-box">T·ª´ hi·ªán t·∫°i: <span id="current-target">---</span></div>
                    </div>
                    <div class="chat-area" id="game-messages"></div>

                    <!-- BIG TIMER: tuy·ªát ƒë·ªëi cƒÉn gi·ªØa v√πng chat -->
                    <div id="big-timer" class="big-timer hidden">
                        <div class="big-timer-label">TH·ªúI GIAN C√íN</div>
                        <div class="big-timer-num" id="big-timer-num">60</div>
                        <div class="big-timer-bar-wrap"><div class="big-timer-bar" id="big-timer-bar"></div></div>
                    </div>

                    <div class="game-controls">

                        <!-- 1. T·ª´ hi·ªán t·∫°i -->
                        <div class="current-word-box">
                            T·ª´ hi·ªán t·∫°i: <span id="current-word">---</span>
                        </div>

                        <!-- 2. Nh·∫≠p t·ª´ n·ªëi -->
                        <div class="input-wrapper word-box">
                            <input type="text" id="word-input" placeholder="Nh·∫≠p t·ª´ n·ªëi..."
                                onkeydown="handleGameInput(event, 'word')">
                            <button id="word-send-btn" onclick="sendWord()">G·ª¨I T·ª™</button>
                        </div>

                        <!-- 3. Nh·∫Øn tin -->
                        <div class="input-wrapper chat-box">
                            <input type="text" id="chat-input" placeholder="Nh·∫Øn tin..."
                                onkeydown="handleGameInput(event, 'chat')">
                            <button onclick="sendChat()">
                                ‚úàÔ∏è
                            </button>
                        </div>

                    </div>

                </div>
                </div><!-- end flex wrapper -->
            </section>

            <section id="sec-admin" class="page hidden">
                <div class="admin-panel glass">
                    <h3><i class="fas fa-shield-check"></i> Natsumi Super Admin</h3>
                    <div class="admin-grid">
                        <button class="btn-main" onclick="buff('gold')">BUFF 1M GOLD</button>
                        <button class="btn-sub" onclick="clearData()">RESET DATABASE</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <div id="countdown-screen" class="overlay hidden">
        <h1 id="cd-number">3</h1>
    </div>

    <div id="profile-modal" class="modal hidden">
        <div class="modal-content glass">
            <h2 style="text-align:center;margin-bottom:20px;">Thi·∫øt l·∫≠p h·ªì s∆°</h2>
            <div class="profile-preview" style="display:flex;justify-content:center;align-items:center;margin-bottom:20px;">
                <img id="preview-img" src="" class="circle-avatar big" style="display:block;margin:0 auto;">
            </div>
            <div class="input-group">
                <label>T√™n hi·ªÉn th·ªã</label>
                <input type="text" id="new-name" placeholder="Nh·∫≠p t√™n m·ªõi...">
            </div>
            <div class="input-group">
                <label>·∫¢nh ƒë·∫°i di·ªán (Link/URL)</label>
                <input type="text" id="new-avatar-link" placeholder="D√°n link ·∫£nh v√†o ƒë√¢y...">
            </div>
            <div class="input-group">
                <label>Ho·∫∑c t·∫£i ·∫£nh t·ª´ m√°y</label>
                <input type="file" id="new-avatar-file" accept="image/*">
            </div>
            <div class="m-btns">
                <button onclick="closeProfile()" class="btn-sub">H·ª¶Y</button>
                <button onclick="saveProfile()" class="btn-main">L∆ØU THAY ƒê·ªîI</button>
            </div>
        </div>
    </div>

    <!-- Modal x√°c nh·∫≠n ƒëƒÉng xu·∫•t -->
    <div id="logout-modal" class="modal hidden">
        <div class="modal-content glass" style="width:360px;text-align:center;">
            <div style="font-size:3rem;margin-bottom:15px;">üëã</div>
            <h3 style="margin-bottom:10px;">ƒêƒÉng xu·∫•t?</h3>
            <p style="color:#a1a1aa;margin-bottom:25px;">B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t kh·ªèi t√†i kho·∫£n kh√¥ng?</p>
            <div style="display:flex;gap:12px;">
                <button onclick="closeLogoutModal()" class="btn-sub" style="flex:1;">Hu·ª∑</button>
                <button onclick="confirmLogout()" class="btn-main" style="flex:1;background:#ef4444;">ƒêƒÉng xu·∫•t</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>

</body>

</html>
